!function(e){function t(n){if(l[n])return l[n].exports;var a=l[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var l={};return t.m=e,t.c=l,t.p="",t(0)}([function(e,l){"use strict";!function(){function e(){var e=t.view().h;d.style.height=e-m.offsetHeight+"px"}function l(e,t){var l=null;return function(){var n=this,a=arguments;clearTimeout(l),l=setTimeout(function(){e.apply(n,a)},t)}}function n(e){for(var t=f.getElementsByClassName("tree-title"),l=0;l<t.length;l++)if(t[l].dataset.id==e)return t[l]}function a(e){n(k).classList.remove("tree-nav"),n(e).classList.add("tree-nav"),h.innerHTML=createNavHtml(u,e);var t=handle.getChildsById(u,e);t.length?p.style.display="none":p.style.display="block",v.innerHTML=createFileHtml(u,e),k=e,C.classList.remove("checked")}function s(e,t){y.className="full-tip-box",setTimeout(function(){y.classList.add(e),y.style.top=0},0),g.innerHTML=t,clearTimeout(y.timer),y.timer=setTimeout(function(){y.style.top="-32px"},2e3)}function i(){if(console.log(T.isCreate),T.isCreate){var e=v.firstElementChild,t=e.getElementsByClassName("file-title")[0],l=e.getElementsByClassName("file-edtor")[0],n=e.getElementsByClassName("edtor")[0],a=n.value.trim();if(a){var i=handle.isTitleExist(u,k,a);if(i)v.removeChild(e),s("warn","命名冲突,请输入其他名称");else{t.style.display="block",l.style.display="none",t.innerHTML=a;var c=Math.ceil(1e4*Math.random());u.unshift({id:c,pid:k,title:a,type:"file"}),e.setAttribute("data-id",c),f.innerHTML=createTreeHtml(u,-1),s("ok","新建成功");var o=r();o.forEach(function(e){var t=e.getElementsByClassName("checkbox")[0];t.classList.remove("checked"),e.classList.remove("file-checked")}),C.classList.remove("checked")}}else v.removeChild(e);T.isCreate=!1}}function r(){return Array.from(L).filter(function(e){return e.classList.contains("checked")}).map(function(e){return t.parent(e,".file-item")})}function c(e){return e.getBoundingClientRect()}function o(e,t){var l=(c(e),c(t),c(e).left),n=c(e).top,a=c(e).right,s=c(e).bottom,i=c(t).left,r=c(t).top,o=c(t).right,d=c(t).bottom;return!(l>o||a<i||n>d||s<r)}var d=document.getElementsByClassName("weiyun-content")[0],m=document.getElementsByTagName("header")[0];e(),window.debuncing=l,t.on(window,"resize",l(e,500));var u=data.files,f=document.getElementsByClassName("tree-menu")[0];f.innerHTML=createTreeHtml(u,-1),$(".tree-menu .ico").bind("click",function(e){$(e.target).closest(".tree-title").toggleClass("show-list");var t=$(e.target).closest(".tree-title").next();$(e.target).closest(".tree-title").hasClass("show-list")?t.css("display","block"):t.css("display","none"),console.log($(e.target).closest(".tree-title").hasClass("show-list"))}),n(0).classList.add("tree-nav");var h=document.getElementsByClassName("path-nav")[0];h.innerHTML=createNavHtml(u,0);var v=document.getElementsByClassName("file-list")[0];v.innerHTML=createFileHtml(u,0);var y=document.getElementsByClassName("full-tip-box")[0],g=y.getElementsByClassName("text")[0],p=document.getElementsByClassName("g-empty")[0],k=0;t.on(f,"click",function(e){var l=e.target;if(l=t.parent(l,".tree-title")){var n=l.dataset.id;a(n)}}),t.on(h,"click",function(e){var t=e.target;if("A"===t.nodeName){var l=t.dataset.id;a(l)}}),t.on(v,"mouseover",function(e){var l=e.target;(l=t.parent(l,".file-item"))&&l.classList.add("file-checked")}),t.on(v,"mouseout",function(e){var l=e.target;if(l=t.parent(l,".file-item")){var n=l.getElementsByClassName("checkbox")[0];n.classList.contains("checked")||l.classList.remove("file-checked")}}),t.on(v,"click",function(e){var l=e.target;if(!t.parent(l,".checkbox")&&(l=t.parent(l,".file-item"))){var s=l.dataset.id;console.log(n(s)),a(s)}});var C=document.getElementsByClassName("checked-all")[0],L=v.getElementsByClassName("checkbox"),E=v.getElementsByClassName("file-item"),L=v.getElementsByClassName("checkbox");t.on(v,"click",function(e){var l=e.target;if(t.parent(l,".checkbox")){l=t.parent(l,".checkbox"),l.classList.toggle("checked");var n=Array.from(L).every(function(e){return e.classList.contains("checked")});n?C.classList.add("checked"):C.classList.remove("checked")}}),t.on(C,"click",function(e){var t=handle.getChildsById(u,k);if(t){var l=this.classList.toggle("checked");Array.from(L).forEach(function(e,t){l?(e.classList.add("checked"),E[t].classList.add("file-checked")):(e.classList.remove("checked"),E[t].classList.remove("file-checked"))})}});var T=document.getElementsByClassName("create")[0];t.on(T,"mouseup",function(){var e=createNewFile(),t=v.firstElementChild;t?v.insertBefore(e,t):v.appendChild(e),p.style.display="none";var l=e.getElementsByClassName("file-title")[0],n=e.getElementsByClassName("file-edtor")[0],a=e.getElementsByClassName("edtor")[0];l.style.display="none",n.style.display="block",a.focus(),T.isCreate=!0}),t.on(document,"keyup",function(e){13===e.keyCode&&i()}),t.on(document,"mousedown",i);var B=document.getElementsByClassName("delete")[0];t.on(B,"click",function(e){var t=r();t.length?$.dialog({asksure:"确定要删除这张图片吗?",title:"删除文件",text:"已删除的文件可以在回收站找到",okFn:function(){var e=[];t.forEach(function(t){e.push(t.dataset.id)}),handle.deleteChildsByIdArr(u,e),f.innerHTML=createTreeHtml(u,-1),a(k),s("ok","删除文件成功")}}):s("warn","请选择删除文件")});var N=null,b=null,x=null,H=[];t.on(document,"mousedown",function(e){if(1===e.which&&(e.preventDefault(),t.parent(e.target,".file-list"))){var l=!1;t.parent(e.target,".file-item")&&(l=!!t.parent(e.target,".file-item").getElementsByClassName("checked")[0]);var n=e.clientX,a=e.clientY;document.onmousemove=function(e){if(l){if(Math.abs(e.clientX-n)<5||Math.abs(e.clientY-a)<5)return;var t=r();x||(x=document.createElement("div"),x.className="numCircle",x.innerHTML='<div class="numCircle">\n\t\t\t\t\t\t\t\t\t\t        '+t.length+"\n\t\t\t\t\t\t\t\t\t\t   </div>",document.body.appendChild(x),b=document.createElement("div"),b.style.cssText="width: 10px;\n        \t\t\t\t\t\t\t\t  height: 10px;\n        \t\t\t\t\t\t\t\t  background: red;\n        \t\t\t\t\t\t\t\t  position: absolute;\n        \t\t\t\t\t\t\t\t  left:0;\n        \t\t\t\t\t\t\t\t  top:0;\n        \t\t\t\t\t\t\t\t  opacity:0;\n\t\t\t\t\t\t\t\t  \t\t ",document.body.appendChild(b)),x.style.left=e.clientX+24+"px",x.style.top=e.clientY+24+"px",b.style.left=e.clientX-5+"px",b.style.top=e.clientY-5+"px";for(var s=0;s<E.length;s++){for(var i=!1,c=0;c<t.length;c++)t[c]===E[s]&&(i=!0);i||(o(b,E[s])?(E[s].classList.add("file-checked"),console.log(Array.from(E[s]))):(E[s].classList.remove("file-checked"),H=null))}}else if(Math.abs(e.clientX-n)>15||Math.abs(e.clientY-a)>15){N||(N=document.createElement("div"),N.className="frame",document.body.appendChild(N)),N.style.width=Math.abs(e.clientX-n)+"px",N.style.height=Math.abs(e.clientY-a)+"px";var d=Math.min(e.clientX,n),m=Math.min(e.clientY,a);d=d<345?345:d,m=m<143?143:m,N.style.left=d+"px",N.style.top=m+"px";for(var s=0;s<E.length;s++)o(N,E[s])?(E[s].classList.add("file-checked"),L[s].classList.add("checked")):(E[s].classList.remove("file-checked"),L[s].classList.remove("checked"));var t=r();t.length==E.length?C.classList.add("checked"):C.classList.remove("checked")}},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,N&&(document.body.removeChild(N),N=null),x&&(document.body.removeChild(b),document.body.removeChild(x),b=null,x=null)}}});var M=document.getElementsByClassName("rename")[0],w={};t.on(M,"click",function(e){var t=r();1==t.length?(w.element=t[0],w.fileTitle=w.element.querySelector(".file-title"),w.fileEdtor=w.element.querySelector(".file-edtor"),w.edtor=w.element.querySelector(".edtor"),w.fileTitle.style.display="none",w.fileEdtor.style.display="block",w.edtor.value=w.fileTitle.innerHTML.trim(),w.edtor.select(),M.isRename=!0):t.length>1?s("warn","只能对单个文件重命名"):s("warn","请选择文件")}),t.on(document,"mousedown",function(){if(M.isRename){var e=w.edtor.value.trim();if(e){var t=handle.isTitleExist(u,k,e);if(e===w.fileTitle.innerHTML.trim());else if(t)s("warn","命名冲突，请重新命名");else{s("ok","命名成功"),w.fileTitle.innerHTML=e;var l=handle.getSelfById(u,w.element.dataset.id);l.title=e,f.innerHTML=createTreeHtml(u,-1)}}w.fileTitle.style.display="block",w.fileEdtor.style.display="none",w.element.classList.remove("file-checked"),w.element.querySelector(".checkbox").classList.remove("checked"),M.isRename=!1}});var I=document.getElementsByClassName("move")[0];t.on(I,"click",function(){for(var e=null,l=!0,n=r(),a=[],i=0;i<n.length;i++)a.push(n[i].dataset.id);if(n.length){if($.dialogMove({titleName:"选择储存位置",fileTitle:handle.getSelfById(u,a[0]).title,content:"<div class='tree-menu-comm tree-move'>"+createTreeHtml(u,-1)+"</div>",okFn:function(){if(l)return!0;for(var t=!1,i=0;i<a.length;i++){var r=handle.getSelfById(u,a[i]),c=handle.isTitleExist(u,e,r.title);c?t=!0:(r.pid=e,v.removeChild(n[i]))}t&&s("warn","文件因重名移动失败"),f.innerHTML=createTreeHtml(u,-1)}}),n.length>1){var c=document.getElementsByClassName("fileNum")[0];c.innerHTML="等"+a.length+"个文件"}var o=document.getElementsByClassName("tree-move")[0],d=handle.getChildsByIdArr(u,a),m=document.getElementsByClassName("error")[0],h=o.getElementsByClassName("tree-title")[0];h.classList.add("tree-nav");var y=h;t.on(o,"click",function(n){var s=n.target;if(s=t.parent(s,".tree-title")){y.classList.remove("tree-nav"),s.classList.add("tree-nav"),y=s,e=s.dataset.id;var i=handle.getSelfById(u,e),r=handle.getSelfById(u,a[0]);if(e==r.pid)return m.innerHTML="该文件下已经存在",void(l=!0);for(var c=!1,o=0;o<d.length;o++)if(i.id==d[o].id){c=!0;break}c?(m.innerHTML="不能将文件移动到自身或其子文件夹下",l=!0):(m.innerHTML="",l=!1)}})}else s("warn","请选择要移动的文件")})}()}]);